# PC System Tool

レース計測データを解析し、区間ごとの通過時間、差分、順位、得点を計算するツールです。

## 機能

- race フォルダ内の CSV ファイルから START/GOAL 時刻を抽出
- 区間ごとの通過時間と設定タイムとの差分を計算
- PC/PCG/CO の3つの競技タイプで順位付けと得点計算
- 総合得点の自動計算
- RIT/N.C./BLNK ステータス管理
- Excel/CSV ファイルへの出力
- **PySide6による高機能GUI（推奨）**
  - テーブル形式の見やすい結果表示
  - 差分・順位の色分け表示
  - タブとフィルター機能
  - スタイリッシュなUI

## 必要な環境

- Python 3.7 以上
- 必要なライブラリ（requirements.txt に記載）
  - pandas
  - openpyxl
  - PySide6 (推奨GUI)

## インストール

```bash
pip install -r requirements.txt
```

## 2つのGUI版

### 1. PySide6版（推奨）- main_pyside6.py
高機能で見やすいGUI実装

**起動方法:**
```bash
python main_pyside6.py
```

**特徴:**
- テーブル形式の美しい結果表示
- 差分セルの自動色分け（緑→黄色→オレンジ→赤）
- 順位セルの色分け（金・銀・銅・薄い青）
- タブで日別表示切り替え
- 区間フィルターボタン
- ソート機能対応

### 2. tkinter版 - main.py
軽量なGUI実装（PySide6が使えない環境向け）

**起動方法:**
```bash
python main.py
```

## フォルダ構成

```
PC System Tool/
├── main_pyside6.py       # メインプログラム（PySide6版・推奨）
├── main.py               # メインプログラム（tkinter版）
├── config_loader.py      # 設定ファイル読み込みモジュール
├── race_parser.py        # race CSV 解析モジュール
├── calculation_engine.py # 計算エンジン
├── output_formatter.py   # Excel/CSV 出力モジュール
├── app_config.py         # アプリ設定管理
├── requirements.txt      # 必要なライブラリ
├── app_config.json       # 設定ファイル（自動生成）
├── PC System Tool_要件定義.txt  # 完全な要件定義書
├── 起動_PySide6版.bat    # Windows用起動スクリプト
├── 起動_tkinter版.bat    # Windows用起動スクリプト（軽量版）
├── sample/               # サンプルデータ
│   ├── race/            # 計測データフォルダ
│   │   ├── PC1START.csv
│   │   ├── PC1GOAL_PC2START.csv
│   │   └── ...
│   └── setting/         # 設定ファイルフォルダ
│       ├── entries_LFAT2025.csv     # 参加者情報
│       ├── point_LFAT2025.csv       # 順位→得点マッピング
│       └── section_LFAT2025.csv     # 区間設定
```

## 使い方

1. **アプリを起動**
   ```bash
   python main.py
   ```

2. **フォルダ設定（初回のみ）**
   - メニュー → 設定 → フォルダ設定
   - race フォルダと settings フォルダのパスを指定
   - サンプルデータを使用する場合: `sample/race` と `sample/setting`

3. **① Setting 読み込み**
   - ツールバーの「① Setting読み込み」ボタンをクリック
   - settings フォルダから設定ファイルを読み込み
   - entries, point, section の3つのファイルを自動検出

4. **② Race データ読み込み**
   - ツールバーの「② Race読み込み」ボタンをクリック
   - race フォルダから計測データを解析
   - すべての START/GOAL 時刻を抽出

5. **③ 計算実行**
   - ツールバーの「③ 計算実行」ボタンをクリック
   - 各区間の通過時間、差分、順位、得点を計算

6. **④ 結果表示**
   - ツールバーの「④ 結果表示」ボタンをクリック
   - 「詳細結果」タブ: 全区間の詳細データ
   - 「総合順位」タブ: 総合得点順の順位表

7. **出力**
   - Excel出力: ツールバーの「Excel出力」ボタン
   - CSV出力: ツールバーの「CSV出力」ボタン

## ステータス設定（RIT/N.C./BLNK）

### 区間ステータス設定
特定のゼッケンの特定区間に RIT / N.C. / BLNK を設定できます。

1. メニュー → ステータス → 区間ステータス設定
2. マトリックス形式（縦軸:ゼッケン、横軸:区間）で一覧表示
3. 各マスのドロップダウンからステータスを選択
4. 「保存」ボタンでまとめて保存

**便利機能:**
- すべてクリア: すべてのステータスを一度にクリア
- 空欄: 通常（ステータスなし）

### 最終ステータス設定
特定のゼッケンの総合順位に RIT / N.C. / BLNK を設定できます。

1. メニュー → ステータス → 最終ステータス設定
2. ゼッケンごとのリストで表示
3. ドロップダウンからステータスを選択
4. 「保存」ボタンで保存

**注意:** 最終ステータスが設定されたゼッケンは総合順位から除外され、総合得点は0になります。

## CO 点数設定

CO 競技のクリア時の点数を変更できます（デフォルト: 500点）
- メニュー → 設定 → CO点数設定
- 点数を入力して保存

## 競技タイプ

### PC (単体競技)
- 設定タイムとの差分の絶対値が小さい順に順位付け
- 順位に応じて得点付与

### PCG (連続区間競技)
- 同じ GROUP に属する PC 区間をまとめた競技
- 最初の PC の START から最後の PC の GOAL までの時間で計算
- 順位付けと得点付与は PC と同じ

### CO (コントロール競技)
- 差分が 0〜59.99 秒でクリア
- クリアしたら一律で CO 点数を付与（デフォルト500点）
- 順位付けなし

## 総合得点計算

```
総合得点 = (PC + PCG の合計) × 係数 × 年齢係数 + CO の合計
```

## サンプルデータ

sample フォルダにサンプルデータが含まれています。
- sample/race/: 計測データ
- sample/settings/: 設定ファイル

## トラブルシューティング

### データ読み込みエラー
- settings フォルダに entries, point, section ファイルが1つずつ存在するか確認
- CSV ファイルの文字エンコーディングが UTF-8 か確認
- 必須列が揃っているか確認

### 計算エラー
- データが正しく読み込まれているか確認
- race フォルダに CSV ファイルが存在するか確認
- time 列と number 列が正しく配置されているか確認

## ライセンス

このツールはプライベート使用を目的としています。
