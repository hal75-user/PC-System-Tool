# クラス別総合結果ガイド

## 概要

クラス別総合結果ページは、車両クラス（CarClass）ごとに独立した総合順位を表示する機能です。総合結果ページとは別に、クラス内での競争を可視化できます。

---

## 機能説明

### 1. クラス別総合結果タブ

**場所:**
```
メインタブ:
[総合成績] [クラス別総合成績] [区間結果 - 全日] [1日目] [2日目] ...
               ↓
           サブタブ:
           [全クラス] [Aクラス] [Bクラス] [Cクラス] ...
```

### 2. 表示される情報

**11列の項目:**
1. **Result** - クラス内順位（1, 2, 3...）またはステータス（RIT/N.C./BLNK）
2. **No** - ゼッケン番号
3. **DriverName** - ドライバー名
4. **CoDriverName** - コドライバー名
5. **CarName** - 車名
6. **車両製造年** - 製造年
7. **CarClass** - 車両クラス
8. **Point** - 純粋な得点（係数なし）
9. **H.C.L Point** - (PC+PCG)*係数*年齢係数+CO
10. **Penalty(-)** - ペナルティ点数（赤字表記）
11. **TotalPoint** - H.C.L Point - Penalty

### 3. 表示特徴

**順位の色付け:**
- **1位**: 金色の背景、太字
- **2位**: 銀色の背景、太字
- **3位**: 銅色の背景、太字

**ペナルティ:**
- 赤字で表示
- 0の場合も "0" と表示（空白にしない）

**Total Resultステータス:**
- RIT/N.C./BLNK の場合、順位の代わりにステータスを表示
- 得点は計算されて表示される
- 順位付けからは除外される

---

## 使い方

### 基本的な使い方

#### 1. クラス別総合結果を表示

```
手順:
1. 「① Setting読み込み」でsettings/*.csvを読み込み
2. 「② Race読み込み」でrace/*.csvを読み込み
3. 「③ 計算実行」で計算を実行
4. 「④ 結果表示」で結果を表示
5. [クラス別総合成績] タブをクリック
```

#### 2. 特定のクラスを表示

```
手順:
1. [クラス別総合成績] タブをクリック
2. 見たいクラスのサブタブ（例: [Aクラス]）をクリック
3. そのクラスのゼッケンのみが表示される
```

#### 3. 全クラスを一覧表示

```
手順:
1. [クラス別総合成績] タブをクリック
2. [全クラス] サブタブをクリック（デフォルト）
3. すべてのクラスが表示される（総合順位）
```

---

## 使用シナリオ

### シナリオ1: クラス別表彰

**目的:** 各クラスのトップ3を表彰したい

```
手順:
1. [Aクラス] タブを開く
   → 1位（金）、2位（銀）、3位（銅）を確認
2. [Bクラス] タブを開く
   → 1位（金）、2位（銀）、3位（銅）を確認
3. [Cクラス] タブを開く
   → 1位（金）、2位（銀）、3位（銅）を確認

結果: 各クラスのトップ3が一目でわかる
```

### シナリオ2: クラス間の比較

**目的:** どのクラスが最も競争が激しいかを確認

```
手順:
1. [Aクラス] タブを開く
   → 1位と2位の得点差を確認
2. [Bクラス] タブを開く
   → 1位と2位の得点差を確認
3. 得点差を比較

結果: どのクラスの競争が激しいかがわかる
```

### シナリオ3: 自分のクラス内順位を確認

**目的:** 総合順位ではなく、同じクラス内での順位を確認

```
手順:
1. [クラス別総合成績] タブを開く
2. 自分のクラスのサブタブを開く
3. 自分のゼッケン番号を探す
4. クラス内順位を確認

例:
- 総合順位: 15位
- Aクラス内順位: 3位（銅メダル）

結果: 総合では15位でも、クラス内では3位！
```

---

## 順位付けのロジック

### 総合結果との違い

**総合結果（全クラス）:**
- すべてのゼッケンで順位付け
- クラスに関係なく得点順

**クラス別結果:**
- クラス内のゼッケンのみで順位付け
- 他のクラスのゼッケンは表示されない

### 具体例

**データ:**
```
ゼッケン5  (Aクラス) H.C.L=1500点
ゼッケン10 (Bクラス) H.C.L=1400点
ゼッケン15 (Aクラス) H.C.L=1300点
ゼッケン20 (Bクラス) H.C.L=1200点
ゼッケン25 (Aクラス) H.C.L=1100点
ゼッケン30 (Bクラス) H.C.L=1000点
```

**総合結果:**
```
1位 ゼッケン5  (Aクラス) 1500点
2位 ゼッケン10 (Bクラス) 1400点
3位 ゼッケン15 (Aクラス) 1300点
4位 ゼッケン20 (Bクラス) 1200点
5位 ゼッケン25 (Aクラス) 1100点
6位 ゼッケン30 (Bクラス) 1000点
```

**Aクラス結果:**
```
1位 ゼッケン5  1500点
2位 ゼッケン15 1300点
3位 ゼッケン25 1100点
```

**Bクラス結果:**
```
1位 ゼッケン10 1400点
2位 ゼッケン20 1200点
3位 ゼッケン30 1000点
```

**重要なポイント:**
- ゼッケン15: 総合3位だが、Aクラス内では2位
- ゼッケン10: 総合2位だが、Bクラス内では1位

---

## Total Resultステータスの扱い

### RIT/N.C./BLNKの表示

**Total Resultステータスが設定されている場合:**
- 順位の代わりにステータス（RIT/N.C./BLNK）が表示される
- 得点は計算されて表示される
- **順位付けからは除外される**（他のゼッケンの順位に影響しない）

**例:**
```
クラス内のゼッケン:
- ゼッケン5: H.C.L=1500点
- ゼッケン10: H.C.L=1400点（Total Result: RIT）
- ゼッケン15: H.C.L=1300点

クラス別結果:
1位 ゼッケン5  1500点
2位 ゼッケン15 1300点
RIT ゼッケン10 1400点（得点は表示されるが順位はつかない）
```

---

## データソース

### CarClass 列

クラス別総合結果は、`entries_*.csv` の **CarClass** 列を使用します。

**entries_*.csv の例:**
```csv
No,DriverName,CoDriverName,CarName,CarYear,CarClass
5,山田太郎,鈴木次郎,トヨタ2000GT,1970,Aクラス
10,佐藤花子,田中一郎,ニッサンフェアレディZ,1975,Bクラス
15,高橋三郎,伊藤四郎,マツダコスモスポーツ,1968,Aクラス
```

**クラスタブ:**
- [全クラス]: すべてのゼッケン
- [Aクラス]: ゼッケン5, 15
- [Bクラス]: ゼッケン10

### クラスの自動検出

- すべてのクラスは自動的に検出されます
- CarClass 列に記載されたすべてのクラスがタブとして表示されます
- 重複は自動的に除去されます
- アルファベット順にソートされます

---

## よくある質問（FAQ）

### Q1: クラス別結果と総合結果の違いは？

**A:** クラス別結果はクラス内での順位、総合結果はすべてのクラスを含めた順位です。

**例:**
- 総合結果: 15位
- Aクラス内: 3位

→ 総合では15位だが、同じクラス内では3位という意味です。

---

### Q2: Total Resultステータスはどう表示される？

**A:** 順位の代わりにステータス（RIT/N.C./BLNK）が表示されますが、得点は計算されます。

**例:**
```
RIT ゼッケン10 H.C.L=1400点
```

---

### Q3: ペナルティはクラス別結果にも反映される？

**A:** はい、反映されます。TotalPoint = H.C.L Point - Penalty で順位付けされます。

---

### Q4: クラス名はどこで設定する？

**A:** `entries_*.csv` の CarClass 列で設定します。

---

### Q5: クラスタブはいくつまで作れる？

**A:** 制限はありません。entries_*.csv に記載されたすべてのクラスがタブとして表示されます。

---

### Q6: クラスがない（空の）ゼッケンはどうなる？

**A:** CarClass 列が空のゼッケンは、[全クラス] タブには表示されますが、個別のクラスタブには表示されません。

---

## 技術詳細

### 実装ファイル

**output_formatter.py:**
- `get_all_classes()`: すべてのクラスを取得
- `get_summary_by_class(class_name)`: クラス別データを生成

**main_pyside6.py:**
- `_update_class_summary_display()`: クラス別タブを作成
- `SummaryTableWidget.set_class_data()`: クラス別データを表示

### データフロー

```
1. entries_*.csv 読み込み
   ↓
2. CarClass 列を取得
   ↓
3. すべてのクラスを抽出（重複なし、ソート）
   ↓
4. 各クラスごとにゼッケンをフィルタリング
   ↓
5. クラス内で順位を計算
   ↓
6. タブとして表示
```

---

## まとめ

クラス別総合結果ページは、総合順位とは別に、クラス内での競争を可視化する強力な機能です。

**主なメリット:**
1. クラス別の表彰が簡単
2. 公平な評価
3. クラス間の比較が可能
4. わかりやすいUI

**おすすめの使い方:**
- 表彰式でクラス別トップ3を発表
- 自分のクラス内順位を確認
- クラス間の競争度を比較

---

**実装日**: 2026年2月17日  
**バージョン**: Phase 6
