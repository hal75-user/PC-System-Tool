# ペナルティとTotal Result機能 - ユーザーガイド

## 📋 概要

ステータス設定画面に2つの新しい列が追加されました。

1. **Total Result列** - 最終結果ステータス（総合順位用）
2. **ペナルティ列** - ペナルティ点数の設定

## 🎯 機能詳細

### 1. Total Result列（最終結果ステータス）

#### 目的
各ゼッケンの最終結果ステータスを設定します。これは区間ステータスとは別のものです。

#### 設定できる値
- **空白** - 通常の完走
- **RIT** - リタイヤ
- **N.C.** - ノーカウント  
- **BLNK** - 欠場

#### 効果
- 総合順位の計算から除外される
- 総合得点は0になる
- 総合成績表に RIT/N.C./BLNK が表示される

#### 使い方

**基本操作:**
```
1. ステータス選択で設定したいステータスを選択（例: RIT）
2. Total Result列のセルをクリック
3. 選択したステータスが設定される
```

**複数ゼッケンを一括設定:**
```
1. ステータス選択で "N.C." を選択
2. Total Result列の複数セルをドラッグ選択
3. すべてのセルに "N.C." が設定される
```

**フィルターとの組み合わせ:**
```
1. フィルターでゼッケン5, 10, 15を絞り込み
2. ステータス選択で "RIT" を選択
3. Total Result列を選択
4. 3つのゼッケンすべてに "RIT" が設定される
```

### 2. ペナルティ列

#### 目的
各ゼッケンにペナルティ点数を設定します。

#### 設定できる値
- 数字（整数または小数）
- 例: 10, 5.5, 20.0

#### 効果
- 現在は設定のみ可能（表示と保存）
- 将来的に総合得点の計算に使用される予定

#### 使い方

**基本操作:**
```
1. ペナルティ列のセルをダブルクリック
2. 数字を入力（例: 10）
3. Enterキーを押すか、他のセルをクリック
```

**小数点の入力:**
```
- "5.5" のように小数点付きで入力可能
- 内部的には float 型で保存される
```

**クリア:**
```
- セルの内容を削除（Backspace/Delete）
- 空白にすると0として扱われる
```

## 🎨 画面レイアウト

```
┌────────────────────────────────────────────────────────────────┐
│ ステータス設定画面                                              │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│ ステータス選択: [空白] [RIT] [N.C.] [BLNK]                     │
│                                                                │
│ ┌─ タブ ─────────────────────────────────────────────┐        │
│ │ [ 全日 ] [ 1日目 ] [ 2日目 ]                       │        │
│ ├──────────────────────────────────────────────────┤        │
│ │                                                  │        │
│ │ ゼッケン│PC1│PC2│...│Total Result│ペナルティ    │        │
│ │ ────────┼───┼───┼───┼────────────┼──────────    │        │
│ │    5    │   │RIT│   │    RIT     │   10        │        │
│ │   10    │N.C│   │   │    N.C.    │   5.5       │        │
│ │   15    │   │   │   │            │             │        │
│ │                                                  │        │
│ └──────────────────────────────────────────────────┘        │
│                                                                │
│ [保存] [キャンセル] [すべてクリア]                             │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### 列の配置

```
[ゼッケン] [区間1] [区間2] ... [区間N] [Total Result] [ペナルティ]
    ↑        ↑       ↑          ↑           ↑             ↑
  固定列  ステータス ステータス ステータス  ステータス    数字入力
          (RIT等)   (RIT等)    (RIT等)    (RIT等)       (10等)
```

### 視覚的な区別

- **ゼッケン列**: グレー背景（編集不可）
- **区間ステータス列**: 白背景（ステータス設定可能）
- **Total Result列**: 白背景（ステータス設定可能）
- **ペナルティ列**: 淡い黄色背景（数字入力）

## 💡 使用例

### 例1: リタイヤしたゼッケンの設定

```
状況: ゼッケン5が2日目でリタイヤ

手順:
1. [2日目] タブをクリック
2. ゼッケン5の区間ステータスに "RIT" を設定
3. [全日] タブに戻る
4. ステータス選択で "RIT" を選択
5. ゼッケン5のTotal Result列をクリック
6. [保存] をクリック

結果:
- 2日目の区間は RIT として記録
- 総合順位からは除外される
- 総合得点は0
```

### 例2: ペナルティの設定

```
状況: ゼッケン10に10点のペナルティ

手順:
1. ゼッケン10のペナルティ列をダブルクリック
2. "10" と入力
3. Enterキーを押す
4. [保存] をクリック

結果:
- ペナルティ10点が保存される
- （将来的に総合得点から減点される予定）
```

### 例3: 複数ゼッケンにN.C.を一括設定

```
状況: ゼッケン5, 10, 15をノーカウントに

手順:
1. [+ 条件追加] で 5, 10, 15 を入力
2. [フィルター適用] をクリック
3. ステータス選択で "N.C." を選択
4. Total Result列の3つのセルをドラッグ選択
5. [保存] をクリック

結果:
- 3つのゼッケン全てに "N.C." が設定
- 総合順位から除外される
```

## 🔄 区間ステータスとTotal Resultの違い

| 項目 | 区間ステータス | Total Result |
|------|---------------|--------------|
| 対象 | 特定の区間 | 最終結果（全体） |
| 複数設定 | 可能（各区間に） | 1つだけ |
| 影響範囲 | その区間の計算のみ | 総合順位全体 |
| 使用例 | PC2でリタイヤ | 最終的にリタイヤ扱い |

### 使い分け

**区間ステータス（RIT/N.C./BLNK）:**
- 特定の区間で問題が発生した場合
- その区間の得点計算に影響
- 例: PC2でリタイヤ → PC2以降の区間は未計測

**Total Result（RIT/N.C./BLNK）:**
- 最終的な総合順位に影響
- 総合得点を0にする
- 例: 最終的にリタイヤ扱い → 総合順位に入らない

## 💾 データの保存

### 保存先
`app_config.json`

### 保存形式
```json
{
  "final_status": {
    "5": "RIT",
    "10": "N.C."
  },
  "penalty_map": {
    "5": 10.0,
    "10": 5.5
  }
}
```

### 自動保存
- 「保存」ボタンをクリックした時に保存
- アプリ再起動時に自動的に読み込まれる

## ⚠️ 注意事項

### ペナルティ列の入力

**有効な入力:**
- 整数: 10, 5, 20
- 小数: 5.5, 10.25, 3.75
- 負の数: -5（減点ではなく加点の意味）

**無効な入力:**
- 文字: "abc", "test"
- 記号: "10点", "5ポイント"
- 無効な入力は保存時に無視される

### Total Resultの動作

**設定した場合:**
- 総合順位から除外
- 総合得点は0
- 区間の得点は計算される（表示のみ）

**未設定の場合:**
- 通常通り総合順位に含まれる
- 総合得点が計算される

## 🚀 今後の実装予定

### ペナルティ点数の使用
- 総合得点からペナルティを減点
- 結果表示にペナルティ列を追加
- ペナルティ考慮後の順位計算

### Total Resultの拡張
- 結果表示での強調表示
- フィルター機能（RITのみ表示など）
- 統計情報の表示

---

**実装日**: 2026年2月17日  
**バージョン**: v3.0  
**互換性**: 既存の設定ファイルとの完全互換
