# ステータス設定画面の新機能 - UI設計書

## 実装した機能

### 1. ゼッケン番号フィルター機能

```
┌─────────────────────────────────────────────────────────────┐
│ ステータス設定画面                                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ セルをクリックまたはドラッグして選択し、選択中のステータスを  │
│ 適用します                                                   │
│                                                             │
│ ステータス選択: [空白] [RIT] [N.C.] [BLNK]                   │
│                                                             │
│ ゼッケン番号フィルター:                                       │
│ ┌───────────────────────────────────┬─────────────┐         │
│ │ [  5  ] [×]                       │ [+ 条件追加] │         │
│ │ [ 10  ] [×]                       │             │         │
│ │ [ 15  ] [×]                       │ [フィルター  │         │
│ │                                   │  適用]       │         │
│ │                                   │             │         │
│ │                                   │ [全表示]     │         │
│ └───────────────────────────────────┴─────────────┘         │
│                                                             │
│ ┌─── タブ ───────────────────────────────────────────┐      │
│ │ [全日] [1日目] [2日目] [3日目]                      │      │
│ ├──────────────────────────────────────────────────┤      │
│ │                                                  │      │
│ │  ゼッケン │ PC1 │ PC2 │ PC3 │ ...               │      │
│ │  ────────┼─────┼─────┼─────┼────               │      │
│ │     5    │     │     │ RIT │                   │      │
│ │    10    │ N.C.│     │     │                   │      │
│ │    15    │     │BLNK │     │                   │      │
│ │                                                  │      │
│ └──────────────────────────────────────────────────┘      │
│                                                             │
│ [保存] [キャンセル] [すべてクリア]                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 機能詳細

#### フィルター機能
1. **条件追加ボタン (+条件追加)**
   - クリックするとゼッケン番号入力欄が追加される
   - 複数の条件を追加可能

2. **条件削除ボタン (×)**
   - 各条件の横にある×ボタンで削除
   - 個別に条件を削除可能

3. **フィルター適用ボタン**
   - 入力されたゼッケン番号で表示を絞り込む
   - 複数の条件はOR条件（いずれかに該当）
   - すべてのタブに適用される

4. **全表示ボタン**
   - フィルターを解除してすべてのゼッケンを表示
   - **重要**: フィルター条件は保持される（消えない）
   - 再度「フィルター適用」を押せば同じ条件で絞り込める

#### タブ機能
1. **全日タブ**
   - すべての区間を表示
   - デフォルトで選択されている

2. **日別タブ (1日目、2日目、...)**
   - section_*.csv の DAY 列に基づいて自動生成
   - 各日の区間のみを表示
   - 結果表示画面と同じ動作

3. **グループタブ（DAY列がない場合）**
   - DAY列がない場合は GROUP 列で代替
   - グループ1、グループ2、... として表示

## 使用例

### 例1: 特定のゼッケンのみ表示
```
1. [+ 条件追加] をクリック
2. ゼッケン番号 "5" を入力
3. [+ 条件追加] をクリック
4. ゼッケン番号 "10" を入力
5. [フィルター適用] をクリック
   → ゼッケン 5 と 10 のみが表示される
```

### 例2: フィルター解除して全表示
```
1. [全表示] をクリック
   → すべてのゼッケンが表示される
   → フィルター条件（5, 10）は保持されている
2. [フィルター適用] をクリック
   → 再びゼッケン 5 と 10 のみが表示される
```

### 例3: 日別タブで作業
```
1. [1日目] タブをクリック
   → 1日目の区間のみが表示される
2. フィルターを適用
   → 1日目の区間で、指定ゼッケンのみが表示される
3. [2日目] タブをクリック
   → 2日目の区間で、同じフィルターが適用される
```

## 実装の詳細

### クラス構成

#### StatusMatrixDialog
- メインのダイアログクラス
- フィルターUI を管理
- 複数のタブを管理
- ステータス選択ボタンを管理
- 保存/クリア機能

#### StatusMatrixTabWidget
- 1つのタブの内容（テーブル）
- ゼッケンのフィルタリング機能
- 行の表示/非表示切り替え
- ステータスの設定と保存

### データフロー

```
フィルター条件入力
    ↓
[フィルター適用] クリック
    ↓
StatusMatrixDialog._apply_filter()
    ↓
各 StatusMatrixTabWidget.apply_filter(zekkens)
    ↓
StatusMatrixTabWidget._update_row_visibility()
    ↓
該当しない行を非表示に設定
```

```
[全表示] クリック
    ↓
StatusMatrixDialog._show_all()
    ↓
各 StatusMatrixTabWidget.show_all()
    ↓
StatusMatrixTabWidget._update_row_visibility()
    ↓
すべての行を表示に設定
    ↓
フィルター条件は保持される（self.filter_conditions は変更なし）
```

## テスト項目

- [x] 構文チェック
- [x] クラス定義の確認
- [x] メソッド定義の確認
- [ ] フィルター条件の追加/削除（手動テスト）
- [ ] フィルター適用（手動テスト）
- [ ] 全表示（条件保持の確認）（手動テスト）
- [ ] タブ切り替え（手動テスト）
- [ ] ステータス設定の保存（手動テスト）

## 互換性

既存の機能との互換性:
- ✅ 既存のステータス設定は正しく読み込まれる
- ✅ 保存フォーマットは変更なし（app_config.json）
- ✅ 既存のステータス設定画面の機能はすべて保持
- ✅ 追加機能のみで、既存機能は変更なし

## 改善点

従来のステータス設定画面からの改善:
1. **フィルター機能** - 多数のゼッケンから特定のものだけを表示
2. **タブ表示** - 日別/グループ別で整理された表示
3. **柔軟な条件管理** - +/-ボタンで条件を自由に追加/削除
4. **条件の永続性** - 全表示後も条件が消えないので再適用が簡単
5. **結果画面との統一** - 結果表示と同じタブ構成で直感的

---

**実装日**: 2026年2月17日  
**実装者**: GitHub Copilot Coding Agent  
**バージョン**: Phase 1 完了
